services:
    mongodb:
        image: mongo:latest
        environment:
            MONGO_INITDB_ROOT_USERNAME: root
            MONGO_INITDB_ROOT_PASSWORD: rootpassword
            MONGO_INITDB_DATABASE: chartstest
        ports:
            - 27017:27017
        volumes:
            - 04_charts_data_container:/data/db
            - ./mongo/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d
        networks:
            - service_bridge    
        profiles: [backend]            
        
    charts:
        image: quay.io/mongodb/charts:19.12.2
        hostname: charts
        environment:
            # This environment variable controls the built-in support widget and
            # metrics collection in MongoDB Charts. To disable both, set the value
            # to "off". The default is "on".
            CHARTS_SUPPORT_WIDGET_AND_METRICS: "on"
            CHARTS_MONGODB_URI: 'mongodb://root:rootpassword@mongodb:27017/chartstest'
        ports:
            # host:container port mapping. If you want MongoDB Charts to be
            # reachable on a different port on the docker host, change this
            # to <port>:80, e.g. 8888:80.
            - 8080:80
            - 8443:443
        volumes:
            - keys:/mongodb-charts/volumes/keys
            - logs:/mongodb-charts/volumes/logs
            - db-certs:/mongodb-charts/volumes/db-certs
            - web-certs:/mongodb-charts/volumes/web-certs
        depends_on:
            - mongodb            
        networks:
            - service_bridge    
        profiles: [backend]   

volumes:
    04_charts_data_container:
    keys:
    logs:
    db-certs:
    web-certs:

networks:
    service_bridge:
        driver: bridge        
        